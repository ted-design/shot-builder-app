/**
 * RichTextEditor CSS Overrides
 *
 * Fixes for dropdown and color picker interaction issues in reactjs-tiptap-editor
 * when used inside modals or high z-index contexts.
 *
 * Issues fixed:
 * 1. Heading dropdown disappearing when mouse moves
 * 2. Color picker not responding to clicks
 */

/* Fix for Radix UI Popper content (used by dropdowns) */
[data-radix-popper-content-wrapper] {
  z-index: 99999 !important;
}

/* Ensure dropdown menu content is above modals and clickable */
[role="menu"][data-radix-menu-content] {
  z-index: 99999 !important;
  pointer-events: auto !important;
}

/* Fix for Color picker popover */
[data-radix-popover-content] {
  z-index: 99999 !important;
  pointer-events: auto !important;
}

/* Ensure popover trigger buttons are clickable */
.rich-text-editor-wrapper [data-radix-popover-trigger] {
  pointer-events: auto !important;
}

/* Ensure dropdown trigger buttons are clickable */
.rich-text-editor-wrapper [data-radix-dropdown-trigger] {
  pointer-events: auto !important;
}

/* Additional safety: ensure all Radix portals are above everything */
[data-radix-portal] {
  z-index: 99999 !important;
}

/* Ensure menu items are interactive */
[data-radix-menu-item] {
  pointer-events: auto !important;
}

/* Ensure color picker internal elements are clickable */
.react-colorful {
  pointer-events: auto !important;
}

.react-colorful * {
  pointer-events: auto !important;
}

/* Fix z-index: Bubble menu should be above content but below modal overlay */
/* Set to 9998 to be below modal backdrops (typically 10000) but above dropdowns */
.rich-text-editor-wrapper .ProseMirror-bubble-menu,
.rich-text-editor-wrapper [class*="bubble"],
.rich-text-editor-wrapper [data-tippy-root] {
  z-index: 9998 !important;
}

/* Ensure toolbar stays accessible and above the bubble menu if needed */
.rich-text-editor-wrapper .richtext-toolbar,
.rich-text-editor-wrapper [class*="toolbar"] {
  z-index: 9999 !important;
  position: relative;
}

/*
 * Fix bubble menu icon/text visibility
 * Bubble menu uses a dark surface in both themes, so foreground must be light.
 *
 * Important: lucide-react icons are stroke-based. Forcing `fill: currentColor`
 * and `stroke: none` makes icons disappear in light mode and fills letter holes
 * (e.g. "B") in dark mode. Use stroke-only rendering and avoid fill.
 */

/* Stroke-based icons (lucide) â€” ensure stroke shows and fill stays transparent */
.rich-text-editor-wrapper .ProseMirror-bubble-menu button svg,
.rich-text-editor-wrapper [class*="bubble"] button svg {
  /* Inherit color from theme defaults; only correct rendering mode */
  stroke: currentColor !important;
  fill: none !important;
  stroke-width: 2 !important;
}

/*
 * Tippy portal awareness
 * Bubble content is rendered into a body-level portal ([data-tippy-root]).
 * Add minimal, safe selectors so colors apply when the portal is outside
 * the editor wrapper. These target only buttons inside tooltip boxes.
 */
[data-tippy-root] .tippy-box button svg {
  /* Respect theme color from library; just force stroke-based icons */
  stroke: currentColor !important;
  fill: none !important;
  stroke-width: 2 !important;
}

/* Light theme: ensure adequate foreground contrast for richtext bubble portals */
html:not(.dark) [data-tippy-root] .tippy-box {
  background-color: rgb(255 255 255) !important; /* white background in light mode */
}

html:not(.dark) [data-tippy-root] .tippy-box [class*="richtext"] {
  color: rgb(17 24 39) !important; /* slate-900 */
}

html:not(.dark) [data-tippy-root] .tippy-box [class*="richtext"] button {
  color: rgb(17 24 39) !important; /* slate-900 for good contrast */
}

html:not(.dark) [data-tippy-root] .tippy-box [class*="richtext"] svg {
  stroke: currentColor !important;
  fill: none !important;
}

/* Fallback when bubble is not portaled */
html:not(.dark) .rich-text-editor-wrapper .ProseMirror-bubble-menu,
html:not(.dark) .rich-text-editor-wrapper [class*="bubble"] {
  color: rgb(17 24 39) !important;
}

html:not(.dark) .rich-text-editor-wrapper .ProseMirror-bubble-menu button,
html:not(.dark) .rich-text-editor-wrapper [class*="bubble"] button {
  color: rgb(17 24 39) !important;
}

/* Dark theme: ensure light foreground on dark background */
html.dark [data-tippy-root] .tippy-box {
  background-color: rgb(31 41 55) !important; /* slate-800 background in dark mode */
}

html.dark [data-tippy-root] .tippy-box [class*="richtext"] button {
  color: rgb(243 244 246) !important; /* slate-100 for good contrast in dark */
}

html.dark .rich-text-editor-wrapper .ProseMirror-bubble-menu button,
html.dark .rich-text-editor-wrapper [class*="bubble"] button {
  color: rgb(243 244 246) !important;
}

/**
 * Compact editor variant for product notes
 * Starts at ~3 lines height and grows up to max-height
 */
.product-note-editor .ProseMirror {
  min-height: 72px !important;
  max-height: 200px;
  overflow-y: auto;
}

.product-note-editor .richtext-editor {
  min-height: auto !important;
}

/* Smaller toolbar for compact variant */
.product-note-editor .richtext-toolbar {
  padding: 4px 8px;
  gap: 2px;
}

.product-note-editor .richtext-toolbar button {
  padding: 4px;
  height: 28px;
  width: 28px;
}

/* Hide wrapper's character counter (library shows its own) */
.product-note-editor > .text-xs.text-right {
  display: none;
}
